<!--
	ì •ì œê· .
	
	ì‹ ê³ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” í˜ì´ì§€.
	
	ëª¨ë°”ì¼ í™”ë©´ì€ ì•„ì´ë”” ê²€ìƒ‰ë§Œ?
	
-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LangTrip | ì‹ ê³ ê´€ë¦¬</title>
<!-- bootstrap CSS CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
	integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style type="text/css">
/*
.search-group {
  margin-bottom: 1rem;
}
.filter-btn-group {
  float: right;
  margin-bottom: 1rem;
}
.pagination {
  justify-content: center;
}
*/

/* í…Œì´ë¸” ì „ì²´ ë„ˆë¹„ ê³ ì • ë° ì…€ ë„ˆë¹„ ë¹„ìœ¨ ìœ ì§€ */
.table {
  table-layout: fixed; /* ì…€ ë„ˆë¹„ ê°•ì œ ê³ ì • */
  width: 100%; /* ì „ì²´ ì˜ì—­ ì‚¬ìš© */
  word-break: break-word;
}

/* ê° ì—´ ë„ˆë¹„ ì„¤ì • (ì˜ˆì‹œ: ì´ 8ê°œ ì—´ ê¸°ì¤€) */
.table th:nth-child(1), .table td:nth-child(1) { width: 7%; }  /* ë²ˆí˜¸ */
.table th:nth-child(2), .table td:nth-child(2) { width: 12%; } /* ì‹ ê³ ì¼ */
.table th:nth-child(3), .table td:nth-child(3) { width: 10%; } /* ì½˜í…ì¸  ìœ í˜• */
.table th:nth-child(4), .table td:nth-child(4) { width: 25%; } /* ì œëª© */
.table th:nth-child(5), .table td:nth-child(5) { width: 12%; } /* í”¼ì‹ ê³ ì¸ ID */
.table th:nth-child(6), .table td:nth-child(6) { width: 12%; } /* ì‹ ê³ ì¸ ID */
.table th:nth-child(7), .table td:nth-child(7) { width: 14%; } /* ì‹ ê³  ì‚¬ìœ  */
.table th:nth-child(8), .table td:nth-child(8) { width: 8%; }  /* ì²˜ë¦¬ìƒíƒœ */

:root {
  --purple-accent: #6366f1;
  --purple-accent-dark: #4f46e5;
  --border-gray: #d1d5db;
  --text-dark: #374151;
}

/* ì œëª© ê°•ì¡°ì„  */
h3 {
  border-left: 4px solid var(--purple-accent);
  padding-left: 12px;
  font-weight: 600;
  color: var(--text-dark);
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-primary {
  background-color: var(--purple-accent);
  border-color: var(--purple-accent);
  font-weight: 500;
}
.btn-primary:hover {
  background-color: var(--purple-accent-dark);
  border-color: var(--purple-accent-dark);
}

/* input/select í¬ì»¤ìŠ¤ ì‹œ ê°•ì¡° */
.form-control:focus, .form-select:focus {
  border-color: var(--purple-accent);
  box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.15);
}

/* ë°‘ì¤„ ê°•ì¡° ë§í¬ */
.text-decoration-underline {
  color: var(--purple-accent);
}
.text-decoration-underline:hover {
  color: var(--purple-accent-dark);
}

/* í˜ì´ì§€ë„¤ì´ì…˜ ê°•ì¡° */
.pagination .page-item.active .page-link {
  background-color: var(--purple-accent);
  border-color: var(--purple-accent);
  color: #fff;
}

.modal-dialog {
  animation: none !important;
  transform: none !important;
}

/* ì•„ë˜ë¶€í„°ëŠ” íŒ€ ì „ìš© ì¤‘ ì¼ë¶€ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f5f7fa;
  /* display: flex; */
}

.sidebar {
  width: 280px;
  height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 2rem 0;
  box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
  position: fixed;
  left: 0;
  top: 0;
  overflow-y: auto;
  transition: all 0.3s ease;
}

.sidebar h2 {
  color: white;
  text-align: center;
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 2rem;
  padding: 0 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.sidebar h2 i {
  font-size: 1.8rem;
  background: rgba(255, 255, 255, 0.2);
  padding: 0.5rem;
  border-radius: 12px;
  backdrop-filter: blur(10px);
}

.sidebar a {
  display: flex;
  align-items: center;
  padding: 1rem 1.5rem;
  color: rgba(255, 255, 255, 0.9);
  text-decoration: none;
  transition: all 0.3s ease;
  margin: 0.2rem 1rem;
  border-radius: 12px;
  font-weight: 500;
  position: relative;
  overflow: hidden;
}

.sidebar a::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.5s;
}

.sidebar a:hover::before {
  left: 100%;
}

.sidebar a:hover {
  background: rgba(255, 255, 255, 0.15);
  color: white;
  transform: translateX(5px);
  backdrop-filter: blur(10px);
}

.sidebar a.active {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  backdrop-filter: blur(10px);
}

.sidebar a i {
  font-size: 1.2rem;
  margin-right: 1rem;
  width: 24px;
  text-align: center;
  transition: transform 0.3s ease;
}

.sidebar a:hover i {
  transform: scale(1.1);
}

/* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
.main-content,
.main {
  margin-left: 280px;
  padding: 2rem;
  flex: 1;
  min-height: 100vh;
  background-color: #f8f9fa;
}

.demo-content {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.demo-content h1 {
  color: #333;
  margin-bottom: 1rem;
}

.demo-content p {
  color: #666;
  line-height: 1.6;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
  .sidebar {
    width: 100%;
    height: auto;
    position: relative;
  }

  .main-content,
  .main {
    margin-left: 0;
  }
}

/* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
.sidebar::-webkit-scrollbar {
  width: 6px;
}

.sidebar::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
}

.sidebar::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.5);
}
</style>
</style>
</head>
<body class="container mt-5">
<div th:replace="~{/layout/admin_sidebar :: sidebar}"></div>

<div class="main-content">
<h3>ì‹ ê³  ëª©ë¡</h3>
<hr>

<!-- ì´ˆê¸°í™” ë²„íŠ¼ -->
<div class="row justify-content-end mb-3">
  <div class="col-12 col-md-auto">
    <div class="d-flex justify-content-md-end">
      <button type="button" class="btn btn-secondary w-100 w-md-auto" id="resetBtn">ì´ˆê¸°í™”</button>
    </div>
  </div>
</div>

<!-- í•„í„°/ê²€ìƒ‰ ì˜ì—­ -->
<form th:action="@{/admin/report/report-list}" method="get" class="mb-4">
  <div class="row g-2 justify-content-md-end">

    <div class="col-12 col-md-auto">
      <select class="form-select" disabled>
        <option value="">ìµœì‹ ìˆœ</option>
      </select>
    </div>

    <div class="col-12 col-md-auto">
      <select name="contentType" id="contentType" class="form-select">
        <option value="">ì½˜í…ì¸  ìœ í˜•</option>
        <option value="ê°•ì˜" th:selected="${pReqDTO.contentType == 'ê°•ì˜'}">ê°•ì˜</option>
        <option value="ê²Œì‹œê¸€" th:selected="${pReqDTO.contentType == 'ê²Œì‹œê¸€'}">ê²Œì‹œê¸€</option>
      </select>
    </div>

    <div class="col-12 col-md-auto">
      <select name="actionStatus" id="actionStatus" class="form-select">
        <option value="">ì²˜ë¦¬ìƒíƒœ</option>
        <option value="ë¯¸ì²˜ë¦¬" th:selected="${pReqDTO.actionStatus == 'ë¯¸ì²˜ë¦¬'}">ë¯¸ì²˜ë¦¬</option>
        <option value="ì œì¬" th:selected="${pReqDTO.actionStatus == 'ì œì¬'}">ì œì¬</option>
        <option value="ë¬´ì œì¬" th:selected="${pReqDTO.actionStatus == 'ë¬´ì œì¬'}">ë¬´ì œì¬</option>
      </select>
    </div>

    <div class="col-12 col-md-auto">
      <input type="text" name="reportedUserId" class="form-control"
             placeholder="í”¼ì‹ ê³ ì¸ ID" th:value="${pReqDTO.reportedUserId}">
    </div>

    <div class="col-12 col-md-auto">
      <input type="text" name="reporterId" id="reporterId" class="form-control"
             placeholder="ì‹ ê³ ì¸ ID" th:value="${pReqDTO.reporterId}">
    </div>

    <div class="col-12 col-md-auto">
      <button type="submit" class="btn btn-primary w-100 w-md-auto" id="searchBtn">ê²€ìƒ‰</button>
    </div>

  </div>
</form>

<!-- ì‹ ê³  ëª©ë¡ í…Œì´ë¸” -->
<table class="table table-bordered table-hover mt-4 text-center align-middle">
  <thead class="table-light">
    <tr>
      <th>ë²ˆí˜¸</th>
      <th>ì‹ ê³ ì¼</th>
      <th>ì»¨í…ì¸  ìœ í˜•</th>
      <th>ì œëª©</th>
      <th>í”¼ì‹ ê³ ì¸ ID</th>
      <th>ì‹ ê³ ì¸ ID</th>
      <th>ì‹ ê³  ì‚¬ìœ </th>
      <th>ì²˜ë¦¬ìƒíƒœ</th>
    </tr>
  </thead>
  <tbody>
    <tr th:each="report, stat : ${pResDTO.list}"
    	th:attr="
    		data-reporter-reasons=${report.reporterReasons},
			data-report-id=${report.reportId}, 
            data-reported-at=${report.reportedAt}, 
            data-content-type=${report.contentType}, 
            data-title=${report.title}, 
            data-reporter-id=${report.reporterId}, 
            data-reported-user-id=${report.reportedUserId}, 
            data-action-status=${report.actionStatus}, 
            data-reported-user-status=${report.reportedUserStatus},
            data-admin-checked-reason=${#strings.arrayJoin(report.adminCheckedReason, ',')},
            data-admin-custom-reason-txt=${report.adminCustomReasonTxt},
            data-admin-acted-at=${report.adminActedAtStr}"
        class="report-row" style="cursor: pointer;">
      <td th:text="${(pResDTO.currentPage - 1) * pReqDTO.size + stat.index + 1}"></td>
      <td th:text="${report.reportedAt}"></td>
      <td th:text="${report.contentType}"></td>
      <td th:text="${report.title}"></td>
      <td th:text="${report.reportedUserId}"></td>
      <td th:text="${report.reporterId}"></td>
      <td th:text="${report.getReporterReasonsSimple()}"></td>
      <td th:text="${report.actionStatus}"></td>
    </tr>
    <tr th:if="${pResDTO.list == null or pResDTO.list.empty}">
      <td colspan="8">ì‹ ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
    </tr>
  </tbody>
</table>

<!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
<nav class="d-flex justify-content-center mt-4">
<ul class="pagination">

  <!-- ë§¨ ì²˜ìŒ í˜ì´ì§€ â‰ª -->
  <li class="page-item" th:classappend="${pResDTO.currentPage == 1} ? 'disabled' : ''">
    <a class="page-link" th:href="@{/admin/report/report-list(
      page=1,
      reporterId=${pReqDTO.reporterId},
      reportedUserId=${pReqDTO.reportedUserId},
      contentType=${pReqDTO.contentType},
      actionStatus=${pReqDTO.actionStatus}
    )}">â‰ª</a>
  </li>

  <!-- ì´ì „ í˜ì´ì§€ ï¼œ -->
  <li class="page-item" th:classappend="${pResDTO.currentPage == 1} ? 'disabled' : ''">
    <a class="page-link" th:href="@{/admin/report/report-list(
      page=${pResDTO.currentPage - 1},
      reporterId=${pReqDTO.reporterId},
      reportedUserId=${pReqDTO.reportedUserId},
      contentType=${pReqDTO.contentType},
      actionStatus=${pReqDTO.actionStatus}
    )}">ï¼œ</a>
  </li>

  <!-- í˜ì´ì§€ ë²ˆí˜¸ ëª©ë¡ -->
  <li class="page-item"
      th:each="p : ${#numbers.sequence(pResDTO.startPage, pResDTO.endPage)}"
      th:classappend="${p == pResDTO.currentPage} ? 'active' : ''">
    <a class="page-link" th:href="@{/admin/report/report-list(
      page=${p},
      reporterId=${pReqDTO.reporterId},
      reportedUserId=${pReqDTO.reportedUserId},
      contentType=${pReqDTO.contentType},
      actionStatus=${pReqDTO.actionStatus}
    )}" th:text="${p}">1</a>
  </li>

  <!-- ë‹¤ìŒ í˜ì´ì§€ â€º -->
  <li class="page-item" th:classappend="${pResDTO.currentPage == pResDTO.totalPages} ? 'disabled' : ''">
    <a class="page-link" th:href="@{/admin/report/report-list(
      page=${pResDTO.currentPage + 1},
      reporterId=${pReqDTO.reporterId},
      reportedUserId=${pReqDTO.reportedUserId},
      contentType=${pReqDTO.contentType},
      actionStatus=${pReqDTO.actionStatus}
    )}">ï¼</a>
  </li>

  <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ â‰« -->
  <li class="page-item" th:classappend="${pResDTO.currentPage == pResDTO.totalPages} ? 'disabled' : ''">
    <a class="page-link" th:href="@{/admin/report/report-list(
      page=${pResDTO.totalPages},
      reporterId=${pReqDTO.reporterId},
      reportedUserId=${pReqDTO.reportedUserId},
      contentType=${pReqDTO.contentType},
      actionStatus=${pReqDTO.actionStatus}
    )}">â‰«</a>
  </li>

</ul>
</nav>

<!-- ì‹ ê³  ìƒì„¸ ëª¨ë‹¬ -->
<div class="modal fade" id="reportDetailModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="reportDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg modal-fullscreen-sm-down">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reportDetailModalLabel">ì‹ ê³  ìƒì„¸ ì •ë³´</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">

		  <!-- ìƒì„¸ ì •ë³´ í…Œì´ë¸” -->
          <table class="table table-bordered">
            <tbody>
              <tr><th>ì‹ ê³  ì‚¬ìœ </th><td id="modal-reason"></td></tr>
              <tr><th>ì½˜í…ì¸  ìœ í˜•</th><td id="modal-contentType"></td></tr>
              <tr><th>ì œëª©</th><td><a href="#" id="modal-title" class="text-decoration-underline"></a></td></tr>
              <tr><th>ì‹ ê³ ì¼</th><td id="modal-date"></td></tr>
              <tr><th>ì‹ ê³ ì¸ ID</th><td id="modal-reporterId"></td></tr>
              <tr><th>í”¼ì‹ ê³ ì¸ ID</th><td id="modal-reportedUserId"></td></tr>
              <tr><th>ì²˜ë¦¬ìƒíƒœ</th><td id="modal-actionStatus"></td></tr>
              <tr><th>ìµœê·¼ ì¡°ì¹˜ì¼</th><td id="modal-adminActedAt"></td></tr>
              <tr><th>í”¼ì‹ ê³ ì¸ ê³„ì • ìƒíƒœ</th><td id="modal-reportedUserStatus"></td></tr>
            </tbody>
          </table>

          <!-- í™•ì¸ ë²„íŠ¼ -->
          <div class="text-end">
            <button type="button" class="btn btn-primary" id="confirmBtn">í™•ì¸</button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- bootstrap bundle CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
<script th:inline="javascript">
document.addEventListener('DOMContentLoaded', () => {

// const list = [[${pResDTO.list}]];
// console.log("ğŸ” pResDTO =", list);

const form = document.querySelector('form');
const resetBtn = document.getElementById('resetBtn');
const searchBtn = document.getElementById('searchBtn');
const reporterInput = document.getElementById('reporterId');

const reportDetailModalEl = document.getElementById('reportDetailModal');
const reportDetailModal = new bootstrap.Modal(reportDetailModalEl);
resetBtn.addEventListener("click", () => {
  location.href = '/admin/report/report-list';
});

document.getElementById('contentType').addEventListener('change', () => {
  form.submit();
});
document.getElementById('actionStatus').addEventListener('change', () => {
  form.submit();
});

searchBtn.addEventListener('click', (e) => {
  if (!reporterInput.value.trim()) {
    e.preventDefault();
    alert("ì‹ ê³ ì¸ IDë¥¼ ì…ë ¥í•´ì•¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    reporterInput.focus();
  }
});

// í•œ í–‰ í´ë¦­ ì‹œ ìƒì„¸ ëª¨ë‹¬ ë„ìš°ê¸° ë° ë°ì´í„° ë°”ì¸ë”©
document.querySelectorAll('.report-row').forEach((row) => {
	row.addEventListener('click', (e) => {
		const data = e.currentTarget.dataset;
			    
		// ëª¨ë‹¬ ë‚´ë¶€ í…ìŠ¤íŠ¸ ì±„ìš°ê¸°
    	document.getElementById('modal-reason').innerText = data.reporterReasons;
		document.getElementById('modal-date').innerText = data.reportedAt;
	    document.getElementById('modal-contentType').innerText = data.contentType;
	    document.getElementById('modal-title').innerText = data.title;
	    // document.getElementById('modal-title').href = '/post/' + data.reportId; // í•„ìš”ì‹œ
	    document.getElementById('modal-reporterId').innerText = data.reporterId;
	    document.getElementById('modal-reportedUserId').innerText = data.reportedUserId;
	    document.getElementById('modal-actionStatus').innerText = data.actionStatus;
	    document.getElementById('modal-adminActedAt').innerText = data.adminActedAt;
	    document.getElementById('modal-reportedUserStatus').innerText = data.reportedUserStatus;

	    // ëª¨ë‹¬ ì—´ê¸°
	    reportDetailModal.show();
	});
});

// ëª¨ë‹¬ì˜ í™•ì¸ ë²„íŠ¼
document.getElementById("confirmBtn").addEventListener("click", () => {
	reportDetailModal.hide();
});

});
</script>
</body>
</html>
