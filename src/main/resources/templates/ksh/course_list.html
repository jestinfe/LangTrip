<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LangTrip - ê°•ì˜ ëª©ë¡</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/course_list.css}">

</head>
<body class="">
    <!-- Header -->
      <div th:replace="layout/header :: header"></div>


    <main class="main-container">
    <div class="page-header">
        <div>
            <h1 class="page-title">ì „ì²´ ê°•ì˜</h1>
<p class="results-count" th:if="${courses != null}" th:text="'ì´ ' + ${#lists.size(courses)} + 'ê°œì˜ ê°•ì˜'"></p>
<p class="results-count" th:unless="${courses != null}">ì´ 0ê°œì˜ ê°•ì˜</p>        </div>
    </div>

    <div class="search-filter-section">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="ì›í•˜ëŠ” ê°•ì˜ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”..." id="searchInput" />
            <span class="search-icon">ğŸ”</span>
        </div>
            
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">ì¹´í…Œê³ ë¦¬</label>
                    <select class="filter-select" id="categoryFilter">
                        <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        <option value="development">ê°œë°œ</option>
                        <option value="design">ë””ìì¸</option>
                        <option value="marketing">ë§ˆì¼€íŒ…</option>
                        <option value="ai-ml">AI/ML</option>
                        <option value="mobile">ëª¨ë°”ì¼</option>
                        <option value="cloud">í´ë¼ìš°ë“œ</option>
                        <option value="data">ë°ì´í„° ë¶„ì„</option>
                        <option value="business">ë¹„ì¦ˆë‹ˆìŠ¤</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">ë‚œì´ë„</label>
                    <select class="filter-select" id="levelFilter">
                        <option value="">ì „ì²´ ë‚œì´ë„</option>
                        <option value="beginner">ì´ˆê¸‰</option>
                        <option value="intermediate">ì¤‘ê¸‰</option>
                        <option value="advanced">ê³ ê¸‰</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">ê°€ê²©</label>
                    <select class="filter-select" id="priceFilter">
                        <option value="">ì „ì²´ ê°€ê²©</option>
                        <option value="free">ë¬´ë£Œ</option>
                        <option value="0-50000">5ë§Œì› ì´í•˜</option>
                        <option value="50000-100000">5ë§Œì›~10ë§Œì›</option>
                        <option value="100000+">10ë§Œì› ì´ìƒ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">ì •ë ¬</label>
                    <select class="filter-select" id="sortFilter">
                        <option value="popular">ì¸ê¸°ìˆœ</option>
                        <option value="newest">ìµœì‹ ìˆœ</option>
                        <option value="rating">í‰ì ìˆœ</option>
                        <option value="price-low">ê°€ê²© ë‚®ì€ìˆœ</option>
                        <option value="price-high">ê°€ê²© ë†’ì€ìˆœ</option>
                    </select>
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn" onclick="applyFilters()">ê²€ìƒ‰</button>
                    <button class="clear-filters" onclick="clearFilters()">ì´ˆê¸°í™”</button>
                </div>
            </div>
            
            <div class="active-filters" id="activeFilters" style="display: none;">
                <!-- Active filter tags will be inserted here -->
            </div>
        </div>

         <!-- ê°•ì˜ ëª©ë¡ -->
    <div class="course-grid" id="courseGrid">
        <div class="course-card" th:each="course : ${courses}">
            <div class="course-thumbnail">
                <div class="course-level" th:text="${course.difficulty}">ì¤‘ê¸‰</div>
                <div class="course-duration" th:text="${course.duration}">12ì‹œê°„</div>
                <img th:src="@{/images/quiz/{thumbnailName}(thumbnailName=${course.thumbnailName})}" th:alt="${course.title}" style="width:100%; height:auto;"/>
            </div>
            <div class="course-info">
                <span class="course-category" th:text="${course.category}">ê°œë°œ</span>
                <h3 class="course-title" th:text="${course.title}">React ì™„ë²½ ë§ˆìŠ¤í„°</h3>
                <div class="course-instructor">
                    <div class="instructor-avatar" th:text="${course.instructorNickname != null ? course.instructorNickname.substring(0,1) : ''}">ê¹€</div>
                    <span class="instructor-name" th:text="${course.instructorNickname}">ê¹€ê°œë°œ</span>
                </div>
                <div class="course-stats">
                    <div class="course-rating">â­ <span th:text="${course.rating}">4.9</span> (<span th:text="${course.students}">1234</span>)</div>
                    <div class="course-students" th:text="${course.students} + 'ëª… ìˆ˜ê°•'">1234ëª… ìˆ˜ê°•</div>
                </div>
                <div class="course-footer">
                    <div class="course-price">
                        <span class="original-price" th:if="${course.originalPrice != course.currentPrice}" th:text="'â‚©' + ${#numbers.formatInteger(course.originalPrice, 0)}">â‚©129,000</span>
                        <span class="current-price" th:text="'â‚©' + ${#numbers.formatInteger(course.currentPrice, 0)}">â‚©89,000</span>
                    </div>
                    <a th:href="@{/courses/enroll/{courseSeq}(courseSeq=${course.courseSeq})}" class="enroll-btn">ìˆ˜ê°•ì‹ ì²­</a>
                </div>
            </div>
        </div>
    </div>


        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <button th:if="${pageResponseDTO.prev}" th:onclick="'goToPage(' + ${pageResponseDTO.startPage - 1} + ')'" id="prevBtn">ì´ì „</button>
            <th:block th:each="i : ${#numbers.sequence(pageResponseDTO.startPage, pageResponseDTO.endPage)}">
                <button th:onclick="'goToPage(' + ${i} + ')'" th:classappend="${i == pageResponseDTO.page ? 'active' : ''}">[[${i}]]</button>
            </th:block>
            <button th:if="${pageResponseDTO.next}" th:onclick="'goToPage(' + ${pageResponseDTO.endPage + 1} + ')'" id="nextBtn">ë‹¤ìŒ</button>
        </div>
          <div th:replace="layout/footer :: footer"></div>
        
    </main>
    

    <script>
        function goToPage(page) {
            const url = new URL(window.location.href);
            url.searchParams.set("page", page);
            window.location.href = url.toString();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value;
            const category = document.getElementById('categoryFilter').value;
            const difficulty = document.getElementById('levelFilter').value;
            const priceRange = document.getElementById('priceFilter').value;
            const sort = document.getElementById('sortFilter').value;

            const url = new URL(window.location.href);
            url.searchParams.set("searchTerm", searchTerm);
            url.searchParams.set("category", category);
            url.searchParams.set("difficulty", difficulty);
            url.searchParams.set("priceRange", priceRange);

            const [orderBy, order] = sort.split(",");
            url.searchParams.set("orderBy", orderBy);
            url.searchParams.set("sort", order);
            url.searchParams.set("page", 1); // Reset to first page on filter change

            window.location.href = url.toString();
        }

        function clearFilters() {
            const url = new URL(window.location.href);
            url.searchParams.delete('searchTerm');
            url.searchParams.delete('category');
            url.searchParams.delete('difficulty');
            url.searchParams.delete('priceRange');
            url.searchParams.delete('orderBy');
            url.searchParams.delete('sort');
            url.searchParams.set('page', 1);
            window.location.href = url.toString();
        }

        // Search input event listener
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                applyFilters();
            }
        });

        // Filter change event listeners
        document.getElementById('categoryFilter').addEventListener('change', applyFilters);
        document.getElementById('levelFilter').addEventListener('change', applyFilters);
        document.getElementById('priceFilter').addEventListener('change', applyFilters);
        document.getElementById('sortFilter').addEventListener('change', applyFilters);

        // Initialize filter values from URL parameters
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('searchInput').value = urlParams.get('searchTerm') || '';
            document.getElementById('categoryFilter').value = urlParams.get('category') || '';
            document.getElementById('levelFilter').value = urlParams.get('difficulty') || '';
            document.getElementById('priceFilter').value = urlParams.get('priceRange') || '';

            const orderBy = urlParams.get('orderBy') || 'popular';
            const sortOrder = urlParams.get('sort') || '';
            document.getElementById('sortFilter').value = `${orderBy},${sortOrder}`;
        });
    </script>
</body>
</html>