<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚´ ê°•ì˜ì‹¤</title>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" th:href="@{/css/upload_lecture.css}">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	
</head>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<body>
	<!-- ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ -->
	<button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
		â˜°</button>

	<!-- ëª¨ë°”ì¼ ì˜¤ë²„ë ˆì´ -->
	<div class="mobile-overlay" onclick="toggleMobileMenu()"></div>

	<div class="container-fluid">
		<div class="row">
			<!-- ì‚¬ì´ë“œë°” -->
			<div class="sidebar" id="sidebar">
				<a href="#" class="active">ğŸ“š í•™ìŠµ</a> <a href="#">ğŸ§  í€´ì¦ˆ</a> <a
					href="#">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</a> <a href="#">ğŸ“‚ ë” ë³´ê¸°</a> <a href="#">ğŸ« ë‚´
					ê°•ì˜ì‹¤</a>
			</div>

			<!-- ë©”ì¸ ì½˜í…ì¸  -->
			<div class="main-content">
				<div class="content-wrapper">
					<div class="lecture-section">
						<div class="lecture-header">
							<a href="/ui/instroductor_course" class="btn btn-success">â† ë‚´ ê°•ì˜ì‹¤</a>
						</div>
							<div id="courseDataSector"></div>
						<div class="course-info">
							<h2 th:text="${courseData.courseTitle}"></h2>
							<div class="course-meta">
								<span th:text="|ê°•ì˜ë²ˆí˜¸: ${courseData.courseSeq}|"> </span>
								<span th:text="|ë“±ë¡ì¼: ${#dates.format(courseData.uploadDate, 'yyyyë…„ Mì›” dì¼ HH:mm')}|"></span>
								<span>ê°•ì˜ìˆ˜: 5ê°œ</span>
							</div>
						</div>
						<div class="video-section">
							<div th:if="${videoList.isEmpty()}" class="lecture-empty">
								ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.
								<div style="margin-top: 20px; font-size: 14px; color: #999;">
									ìƒˆë¡œìš´ ê°•ì˜ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</div>
<!-- 								<div> -->
<!-- 									<h1 th:text="${courseData.courseTitle}"></h1> -->
<!-- 								</div> -->
							</div>
							
							<div th:if="${videoList != null and !videoList.isEmpty()}">
								<h3>ë“±ë¡ëœ ê°•ì˜ ì˜ìƒ ëª©ë¡</h3>
								<div class="video-tree">
									<div th:each="video, stat : ${videoList}" class="video-node"
										th:classappend="inactive">

										<button type="button" class="circle-button"
											th:onclick="'location.href=\'/video/watch?videoSeq=' + ${video.videoSeq} + '\''">
											<i class="fa-solid"
												th:classappend="${video.type == 'video' ? 'fa-star' : 'fa-book'}"></i>
										</button>
									</div>
								</div>
								
							</div>
						</div>

						<!-- ìš°ì¸¡ ì„¤ëª… íŒ¨ë„ -->
					<div class="right-panel">
						<div class="side-panel">
							<h5>ğŸ“š ê°•ì˜ ì»¨í…ì¸  ë“±ë¡</h5>
							<p class="mb-3">ìƒˆë¡œìš´ ê°•ì˜ ì½˜í…ì¸ ë¥¼ ë“±ë¡í•˜ì„¸ìš”.</p>
							<a th:href="@{/upload/upload_video(seq=${courseData.courseSeq})}" class="btn btn-outline-primary btn-sm w-100 mb-2">
							ğŸ¬ ì˜ìƒ ë“±ë¡</a>
							<a th:href="@{/quiz/addQuizForm(seq=${courseData.courseSeq})}" class="btn btn-outline-primary btn-sm w-100 mb-2">
							â“ í€´ì¦ˆ ë“±ë¡</a>
<!-- 							<button class="btn btn-outline-secondary btn-sm">â“ í€´ì¦ˆ ë“±ë¡</button> -->
						</div>
						
						<div class="side-panel">
							<h5>ğŸ“Š ê°•ì˜ í†µê³„</h5>
							<p class="mb-3">ê°•ì˜ ì§„í–‰ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
							<div style="background: #e3f2fd; padding: 15px; border-radius: 12px; margin-bottom: 15px;">
								<div style="font-size: 14px; color: #4a90e2; margin-bottom: 5px;">ì „ì²´ ì§„ë„ìœ¨</div>
								<div style="font-size: 24px; font-weight: 700; color: #4a90e2;">85%</div>
							</div>
							<div style="background: #e8f5e8; padding: 15px; border-radius: 12px;">
								<div style="font-size: 14px; color: #4CAF50; margin-bottom: 5px;">ì™„ë£Œëœ ê°•ì˜</div>
								<div style="font-size: 24px; font-weight: 700; color: #4CAF50;">4/5</div>
							</div>
						</div>
						
						<div class="side-panel">
							<h5>âš™ï¸ ê°•ì˜ ì„¤ì •</h5>
							<p class="mb-3">ê°•ì˜ ì„¤ì •ì„ ë³€ê²½í•˜ì„¸ìš”.</p>
							<button class="btn btn-outline-primary btn-sm mb-2">âœï¸ ê°•ì˜ ìˆ˜ì •</button>
							<button class="btn btn-outline-secondary btn-sm">ğŸ—‘ï¸ ê°•ì˜ ì‚­ì œ</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
								<!-- ì±—ë´‡ ëª¨ë‹¬ -->
								<div class="chatbot-modal" id="chatbotModal">
									<div class="chatbot-container">
										<div class="chatbot-header">
											<h4>ğŸ¤– í•™ìŠµ ë„ìš°ë¯¸</h4>
											<button class="chatbot-close" onclick="toggleChatbot()">Ã—</button>
										</div>
										<div class="chatbot-messages" id="chatbotMessages">
											<div class="message bot">ì•ˆë…•í•˜ì„¸ìš”! í•™ìŠµ ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?
											</div>
										</div>
										<div class="chatbot-input">
											<div class="chatbot-input-group">
												<input type="text" id="chatbotInput"
													placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
													onkeypress="handleChatbotEnter(event)">
												<button class="chatbot-send" onclick="sendChatbotMessage()">ì „ì†¡</button>
											</div>
										</div>
									</div>
								</div>
							</div>
				

		<!-- í”„ë¡œí•„ ìºë¦­í„° (ì±—ë´‡ ë²„íŠ¼) -->
		<div class="profile-icon" onclick="toggleChatbot()">
			<img src="/images/mascot2.png" alt="ë§ˆìŠ¤ì½”íŠ¸"
				onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiM0YTkwZTIiLz4KPHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTUiIGN5PSIxNSIgcj0iMTUiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjEwIiBjeT0iMTIiIHI9IjIiIGZpbGw9IiMzMzMiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMiIgZmlsbD0iIzMzMyIvPgo8cGF0aCBkPSJNMTAgMjBRMTUgMjUgMjAgMjAiIHN0cm9rZT0iIzMzMyIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo8L3N2Zz4K'">
		</div>


		<script>
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function toggleChatbot() {
            const modal = document.getElementById('chatbotModal');
            modal.classList.toggle('active');
        }

        function sendChatbotMessage() {
            const input = document.getElementById('chatbotInput');
            const messages = document.getElementById('chatbotMessages');
            const message = input.value.trim();
            
            if (message) {
                // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.textContent = message;
                messages.appendChild(userMessage);
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                input.value = '';
                
                // ì±—ë´‡ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
//                 setTimeout(() => {
//                     const botResponse = document.createElement('div');
//                     botResponse.className = 'message bot';
//                     botResponse.textContent = getBotResponse(message);
//                     messages.appendChild(botResponse);
                    
//                     // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
//                     messages.scrollTop = messages.scrollHeight;
//                 }, 1000);
                
                axios.post("/api/chat", message, {
                	headers:{
                		"Content-Type": "text/plain"
                	}
                }).
                then(res=>{
  					const botResponse = document.createElement('div');
  					botResponse.className = 'message bot';
  					botResponse.textContent = res.data;
  					messages.scrollTop = messages.scrollHeight;
  					messages.appendChild(botResponse);
  					messages.scrollTop = messages.scrollHeight;
                }).
                catch(err=>{
                	 const errorMsg = document.createElement('div');
                     errorMsg.className = 'message bot';
                     errorMsg.textContent = "ì˜¤ë¥˜ ë°œìƒ: " + err;
                     messages.appendChild(errorMsg);
                });
                // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
//                 messages.scrollTop = messages.scrollHeight;
            }
        }
        function handleChatbotEnter(event) {
            if (event.key === 'Enter') {
                sendChatbotMessage();
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('chatbotModal').addEventListener('click', function(e) {
            if (e.target === this) {
                toggleChatbot();
            }
        });

        // ì‚¬ì´ë“œë°” ë§í¬ í™œì„±í™”
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
                this.classList.add('active');
                
                // ëª¨ë°”ì¼ì—ì„œ ë©”ë‰´ í´ë¦­ ì‹œ ì‚¬ì´ë“œë°” ë‹«ê¸°
                if (window.innerWidth <= 768) {
                    toggleMobileMenu();
                }
            });
        });

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì‚¬ì´ë“œë°” ìƒíƒœ ì´ˆê¸°í™”
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('active');
                document.querySelector('.mobile-overlay').classList.remove('active');
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì• ë‹ˆë©”ì´ì…˜
        document.addEventListener('DOMContentLoaded', function() {
            const panels = document.querySelectorAll('.side-panel');
            panels.forEach((panel, index) => {
                panel.style.animationDelay = `${index * 0.1}s`;
            });
        });
        
        
        
//         document.addEventListener("DOMContentLoaded", function () {
//         	  const courseData = sessionStorage.getItem("newCourse");
//         	  if (courseData) {
//         	    const c = JSON.parse(courseData);

//         	    const html = `
//         	      <div class="box">
//         	        <strong>${c.courseTitle}</strong><br/>
//         	        ê°•ì˜ë²ˆí˜¸: ${c.courseSeq}<br/>
//         	        ë“±ë¡ì¼: ${c.uploadDate}
//         	      </div>
//         	    `;

//         	    document.getElementById("courseDataSector").innerHTML = html;

//         	    // ì‚¬ìš© í›„ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚­ì œ (ì›í•˜ë©´ ì£¼ì„ì²˜ë¦¬ ê°€ëŠ¥)
//         	    sessionStorage.removeItem("newCourse");
//         	  }
//         	});
        
    </script>
		
</body>
</html>